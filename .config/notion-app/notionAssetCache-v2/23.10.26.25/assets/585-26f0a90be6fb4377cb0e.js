"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[585],{48298:(e,t,s)=>{s.d(t,{kn:()=>u,kj:()=>g,Tr:()=>b});s(33948);var a=s(58129),o=s(75246),i=s(19889),r=s(50906),n=s(54642),l=s(76464),d=s(9953),c=s(93561),p=s(41952),m=s(98905);const u=async e=>{const{environment:t,store:s,accessRequestStore:a,forActor:o,status:n,from:p}=e,m=t.currentUser.id;if("approved"===n){const e={type:"existingUser",value:o,spaceRole:"read_and_write"};if(!(await l.n_({environment:t,store:s,inviteTargets:[e],inviteRole:"read_and_write",isOnboarding:!1,invite:{inviteOrigin:"membership_request"}})).success)return}c.createAndCommit({userAction:"GrantAccessActivityAction.handleGrantAccess",environment:t,perform:e=>{d.sW({store:a,transaction:e,data:{granted_time:Date.now(),granted_by_table:i.KJ,granted_by_id:m,resolved_time:Date.now(),resolved_by_table:i.KJ,resolved_by_id:m,status:n}})}}),r.trackResolveMembershipRequest(t,{status:n,request_id:a.getKeyStore("id").getValue(),from:p,for_actor_id:o.id,space_role:s.getRole()})};async function g(e){if(m.Z.reset(),!e.canAdmin)return;const{environment:t,spaceId:s}=e,a=await n.getUnreadAccessRequestCount(t,{parentTable:o.bx,parentId:s,size:1});"success"===a.type&&m.Z.setState({spaceId:s,count:a.data.count})}function b(e,t){const s=new Map;for(const o of t){const t=(0,p.Kv)(e,{table:a.J8,id:o}),r=t.getValue();if(!r)continue;if(r.for_actor_table!==i.KJ||r.created_by_table!==i.KJ)continue;const n=(0,p.Kv)(e,{table:r.for_actor_table,id:r.for_actor_id}).getValue();if(!n)continue;const l=(0,p.Kv)(e,{table:r.created_by_table,id:r.created_by_id}).getValue();if(l)if(s.has(r.for_actor_id)){const e=s.get(r.for_actor_id);if(!e)continue;r.created_time>e.latestRequestTime?s.set(r.for_actor_id,{...e,createdByActors:[l,...e.createdByActors.filter((e=>e.id!==l.id))],accessRequest:r,accessRequestStore:t,latestRequestTime:r.created_time}):s.set(r.for_actor_id,{...e,createdByActors:[...e.createdByActors.filter((e=>e.id!==l.id)),l]})}else s.set(r.for_actor_id,{forActor:n,createdByActors:[l],accessRequest:r,accessRequestStore:t,latestRequestTime:r.created_time})}return Array.from(s.values())}},82276:(e,t,s)=>{s.d(t,{T:()=>b});var a=s(97464),o=s.n(a),i=s(77094),r=s.n(i),n=s(67294),l=s.n(n),d=s(24405),c=s(53397),p=s(26825),m=s(5366),u=s(86646);function g(e){const{enabled:t,labelIfEnabled:s,labelIfDisabled:a}=e,o=(0,d.y)((e=>({container:{color:t?e.mediumTextColor:e.lightTextColor}})),[t]);return r()("div",{style:o.container},void 0,function(e){const t={width:12,display:"inline",verticalAlign:"middle"};return e?c.Z.thinCheck(t):c.Z.close(t)}(t)," ",t?s:a)}function b(e){const{role:t,renderUserCapabilities:s}=e,a=(0,d.F)(),i=(0,m.useIntl)();return"object"!=typeof t?r()("div",{}):l().createElement(u.Z,o()({},e,{title:i.formatMessage((0,p.Gx)(t,void 0).label),shouldWrapCaption:!0,style:{padding:4,marginTop:2,marginBottom:2},captionStyle:{marginTop:4},caption:r()("div",{},void 0,r()(g,{enabled:t.read_content,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.mixedAccess.readContent.enabled",defaultMessage:"Can read content."}),labelIfDisabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.readContent.disabled",defaultMessage:"Cannot read content."})}),r()(g,{enabled:t.insert_content,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.insertContent.enabled",defaultMessage:"Can insert content."}),labelIfDisabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.insertContent.disabled",defaultMessage:"Cannot insert content."})}),r()(g,{enabled:t.update_content,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.updateContent.enabled",defaultMessage:"Can update content."}),labelIfDisabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.mixedaccess.updateContent.disabled",defaultMessage:"Cannot update content."})}),t.insert_comment&&r()(g,{enabled:!0,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.insertComment.enabled",defaultMessage:"Can comment.",description:"Label indicating that an integration can comment on a page"}),labelIfDisabled:null}),t.read_comment&&r()(g,{enabled:!0,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.readComment.enabled",defaultMessage:"Can read comments.",description:"Label indicating that an integration can read comments on a page"}),labelIfDisabled:null}),s?h(t,a):r()("div",{}))}))}function h(e,t){if("object"!=typeof e)return;const s=Boolean("read_user_without_email"in e&&e.read_user_without_email),a=Boolean("read_user_with_email"in e&&e.read_user_with_email);return r()("div",{},void 0,r()(g,{enabled:s,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUsers.enabled",defaultMessage:"Can view users."}),labelIfDisabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUsers.disabled",defaultMessage:"Cannot view users."})}),r()(g,{enabled:a,labelIfEnabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUserEmailAddresses.enabled",defaultMessage:"Can view user email addresses."}),labelIfDisabled:r()(m.FormattedMessage,{id:"capabilitiesTooltip.userAccess.readUserEmailAddresses.disabled",defaultMessage:"Cannot view user email addresses."})}))}},7567:(e,t,s)=>{s.d(t,{Z:()=>N});var a=s(97464),o=s.n(a),i=s(77094),r=s.n(i),n=s(77422),l=s.n(n),d=(s(33948),s(67294)),c=s.n(d),p=s(83355),m=s(41892),u=s(8848),g=s(53397),b=s(26825),h=s(27006),f=s(75246),v=s(97880),M=s(5366),y=s(47307),_=s(93678),w=s(95477),C=s(43250),R=s(98742),T=s(67669),A=s(21115),F=s(27832),k=s(61766),Z=s(95155),P=s(60709),I=s(48762),S=s(46167),U=s(82276),E=s(71202),q=s(86646),x=s(25584),L=s(26524),B=s(42001),D=s(83071),W=s(37235),O=s(60442),K=s(46951),G=s(42115);class J extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{buttonPopupStore:k.Z}),l()(this,"renderPermissionOverrideLabel",(()=>{const{device:e}=this.environment;return r()(K.Z,{style:{padding:12,backgroundColor:this.theme.sidebarSecondaryBackground,boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor),marginTop:e.isMobile?28:1},isMultiline:!0,isSmall:!0},void 0,r()(M.FormattedMessage,{id:"permissionRoleSelect.overrideMessage.caption",defaultMessage:"Youâ€™ll override permissions from the parent page if you change this role."}))})),l()(this,"isRemovingSelfRole",(e=>this.props.isUserPermission&&(0,b.nl)(this.props.role,e)===this.props.role&&"none"===e)),l()(this,"isDowngradingSelfRole",(e=>this.props.isUserPermission&&(0,b.nl)(this.props.role,e)===this.props.role)),l()(this,"handleSelectChange",(e=>{const{table:t}=this.props,s=()=>{this.props.onChange&&this.props.onChange(e)};this.getItemDisabledReason(e)&&!w.Z.isAdminMode?(_.y(this.environment,{from:this.props.upgradeButtonName,for:A.M9(this.environment)||"team"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()):this.isRemovingSelfRole(e)?y.showDialog({showCancel:!0,keepFocus:!1,message:t===f.bx?r()(M.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeSelfFromWorkspace.confirmationMessage",defaultMessage:"Are you sure you want to remove your own access? You will lose access to the workspace, and any private pages will be lost."}):r()(M.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeSelfFromPage.confirmationMessage",defaultMessage:"Are you sure you want to remove your own access?"}),items:[{label:r()(M.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeSelfButton.label",defaultMessage:"Remove"}),color:"red",onAccept:s}]}):this.isDowngradingSelfRole(e)?y.showDialog({showCancel:!0,keepFocus:!1,message:r()(M.FormattedMessage,{id:"userPermissionsMenu.downgradePermissionsModal.downgradeSelfFromWorkspaceOrPage.confirmationMessage",defaultMessage:"Are you sure you want to downgrade your own access?",description:"Warning that shows when you try to downgrade your own space role"}),items:[{label:r()(M.FormattedMessage,{id:"userPermissionsMenu.downgradePermissionsModal.downgradeSelfButton.label",defaultMessage:"Downgrade",description:"Downgrade self button label in settings modal"}),color:"red",onAccept:s}]}):this.isRemovingSpaceUser(e)?y.showDialog({showCancel:!0,keepFocus:!1,message:t===f.bx?r()(M.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserFromWorkspace.confirmationMessage",defaultMessage:"Are you sure you want to remove this person? They will lose access to the workspace, and any private pages will be lost."}):r()(M.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserFromPage.confirmationMessage",defaultMessage:"Are you sure you want to remove this person?"}),items:[{label:r()(M.FormattedMessage,{id:"userPermissionsMenu.removePermissionsModal.removeUserButton.label",defaultMessage:"Remove"}),color:"red",onAccept:s}]}):s()}))}renderComponent(){const{device:e}=this.environment;return r()(S.Z,{onClick:e=>{e.stopPropagation()},popupType:e.isMobile?S.Z.PopupType.SlideUp:S.Z.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>this.props.origin?this.props.origin:this.props.isMenuItem?c().createElement(I.Z,o()({},e,{title:c().createElement(M.FormattedMessage,this.getItemLabelAndCaption(this.props.role).label),focused:!1,showExtensionArrow:!0})):c().createElement(B.Z,o()({disabled:this.props.disabled,style:{marginRight:8,...this.props.buttonStyle}},e),this.props.buttonContents||r()("span",{className:"notranslate"},void 0,c().createElement(M.FormattedMessage,this.getItemLabelAndCaption(this.props.role).label)),!this.props.disabled&&g.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),placementToOrigin:this.props.placementToOrigin?this.props.placementToOrigin:P.Iw.Bottom,alignmentToOrigin:this.props.alignmentToOrigin,render:t=>{let s,a;if((0,b.oF)(this.props.role))s=[{key:"mixed_role_section",render:e=>c().createElement(D.Z,o()({},e,{topBorder:!1})),items:[{key:"mixed_role_description",render:()=>r()(U.T,{role:this.props.role,renderUserCapabilities:!1}),action:()=>{}}]},{key:"bot_capabilities_warning",render:e=>c().createElement(D.Z,o()({},e,{topBorder:!0})),items:[{key:"warning_details",render:e=>c().createElement(q.Z,o()({},e,{shouldWrapCaption:!0,caption:"Integration permissions cannot be changed on a page. You can manage integrations in settings."})),action:()=>{}}]},{key:"remove_bot",render:e=>c().createElement(D.Z,o()({},e,{topBorder:!0})),items:[{key:"none",render:e=>this.getItem({role:"none"},e.focused,e),action:()=>{this.handleSelect("none"),t.close()}}]}];else{s=[{key:"roles",render:e=>c().createElement(D.Z,o()({},e,{topBorder:0!==e.index})),items:this.getAvailableRoles().map((e=>({key:e.role,render:t=>this.getItem(e,t.focused,t),action:()=>{this.handleSelect(e.role),t.close()}})))}]}return a=e.isMobile?{menuType:E.Z.MenuType.Modal,title:r()(M.FormattedMessage,{id:"userPermissionsMenu.mobile.title",defaultMessage:"Select role"}),right:r()(M.FormattedMessage,{id:"userPermissionsMenu.mobile.doneButton.label",defaultMessage:"Done"}),onClickRight:t.close}:{menuType:E.Z.MenuType.Popup,width:264},c().createElement(E.Z,o()({className:C.a6,header:this.props.header,footer:this.props.footer},a),r()(x.Z,{type:x.Z.Type.Vertical,initialFocus:void 0,sections:s}),this.props.showPermissionOverrideWarning&&this.renderPermissionOverrideLabel())}})}getItemLabelAndCaption(e){if("object"==typeof e)return(0,b.Gx)(e,this.props.table);const t="on"===Z.default.getGroup("show_workspace_owner");switch(e){case"editor":return this.props.table===f.bx?t?{label:b.mq.workspaceOwnerLabel,caption:b.mq.workspaceOwnerCaption}:{label:b.mq.adminLabel,caption:b.mq.adminCaption}:{label:b.mq.fullAccessLabel,caption:b.mq.fullAccessCaption};case"membership_admin":return this.props.table===f.bx?{label:b.mq.membershipAdminLabel,caption:b.mq.membershipAdminCaption}:{label:b.mq.canEditLabel,caption:b.mq.canEditCaption};case"read_and_write":return this.props.table===f.bx?{label:b.mq.memberLabel,caption:b.mq.memberCaption}:{label:b.mq.canEditLabel,caption:b.mq.canEditCaption};case"content_only_editor":return{label:b.mq.canEditContentLabel,caption:b.mq.canEditContentCaption};case"reader":return{label:b.mq.canReadLabel,caption:b.mq.canReadCaption};case"comment_only":return{label:b.mq.canCommentLabel,caption:b.mq.canCommentCaption};case"none":return"user_permission"===this.props.type||"bot_permission"===this.props.type||"group_permission"===this.props.type?this.props.table===f.bx?this.props.isUserPermission?{label:b.mq.leaveWorkspaceLabel,style:{color:u.ZP.red}}:{label:b.mq.removeFromWorkspaceLabel,style:{color:u.ZP.red}}:{label:b.mq.removeWorkspaceLabel,style:{color:u.ZP.red}}:{label:b.mq.noAccessLabel,style:{color:u.ZP.red}};default:(0,v.t1)(e)}}getItem(e,t,s){return this.renderItem({...this.getItemLabelAndCaption(e.role),focused:t,props:s,disabledMessage:this.getItemDisabledReason(e.role),availableRole:e})}renderItem(e){const{device:t}=this.environment,{onClick:s,key:a,...i}=e.props,n=e.availableRole.disabledInfo;return n&&n.isDisabled?r()(W.Z,{delayThreshold:0,renderTooltip:e=>c().createElement("div",e,n.disabledMessage),placement:W.Z.Placement.Right,textWrap:!0,render:s=>c().createElement(I.Z,o()({},s,{focused:e.focused,disabled:!0,disabledFeedback:!0,right:this.props.role===e.availableRole.role?r()("div",{style:{width:t.isMobile?16:14}},void 0,g.Z.check()):void 0,title:r()("div",{style:{display:"flex",alignItems:"center"}},void 0,r()("div",{style:{...e.style,marginRight:e.disabledMessage?6:0}},void 0,c().createElement(M.FormattedMessage,e.label))),caption:e.caption&&r()("span",{style:{color:this.theme.mediumTextColor}},void 0,c().createElement(M.FormattedMessage,e.caption)),shouldWrapCaption:!0}))}):r()(G.Z,{requireUpgradeToTier:Boolean(e.disabledMessage)&&A.M9(this.environment),analyticsName:this.props.upgradeButtonName,renderUpgradeTooltip:()=>e.disabledMessage,tooltipPlacement:W.Z.Placement.Left,onClick:s,onUpgradeClick:this.props.onUpgradeButtonClick,render:(s,a)=>{const{focused:n,...l}=(0,R.Z)(i,s);return c().createElement(I.Z,o()({},l,{focused:n||e.focused,right:this.props.role===e.availableRole.role?r()("div",{style:{width:t.isMobile?16:14}},void 0,g.Z.check()):void 0,title:r()("div",{style:{display:"flex",alignItems:"center"}},void 0,r()("div",{style:{...e.style,marginRight:e.disabledMessage?6:0}},void 0,c().createElement(M.FormattedMessage,e.label)),a,e.availableRole.tag&&r()(L.Z,{desktopStyle:{marginLeft:7}},void 0,e.availableRole.tag)),caption:e.caption&&r()("span",{style:{color:this.theme.mediumTextColor}},void 0,c().createElement(M.FormattedMessage,e.caption)),shouldWrapCaption:!0,disabled:!!t.isMobile&&Boolean(e.disabledMessage)}))}},a)}getItemDisabledReason(e){switch(A.CM(this.environment)){case"personal_free":const{currentSpaceStore:t}=F.default.state;if(h.zz(e)&&!(this.props.isUserPermission&&t&&t.canEdit()))return r()(O.Z,{imageURL:m.Z.images.tooltips.upsells.userFullAccessPng,imageWidth:240,imageHeight:100,caption:r()(M.FormattedMessage,{defaultMessage:"Guests with full access can edit a page and share it with others.",id:"permissionRoleSelect.userEditorUpgradeTooltip.caption"}),title:r()(M.FormattedMessage,{defaultMessage:"Upgrade to grant full access",id:"permissionRoleSelect.userEditorUpgradeTooltip.title"})});break;case"team_free":if((this.props.table===f.bx?h.RN(e):h.J5(e)&&!h.zz(e))&&"public_permission"!==this.props.type&&"bot_permission"!==this.props.type)return this.props.table===f.bx?r()(O.Z,{imageURL:m.Z.images.tooltips.upsells.spaceReadAndWritePng,imageWidth:240,imageHeight:100,caption:r()(M.FormattedMessage,{defaultMessage:"Members cannot change workspace settings or invite new members.",id:"permissionRoleSelect.spaceReadAndWriteUpgradeTooltip.caption"}),title:r()(M.FormattedMessage,{defaultMessage:"Upgrade to add non-admin members",id:"permissionRoleSelect.spaceReadAndWriteUpgradeTooltip.title"})}):r()(O.Z,{imageURL:m.Z.images.tooltips.upsells.userReadAndWritePng,imageWidth:240,imageHeight:100,caption:r()(M.FormattedMessage,{defaultMessage:"Users with edit access can edit a page but not share it with others.",id:"permissionRoleSelect.userReadAndWriteUpgradeTooltip.caption"}),title:r()(M.FormattedMessage,{defaultMessage:"Upgrade to add editors",id:"permissionRoleSelect.userReadAndWriteUpgradeTooltip.title"})})}return!1}getAvailableRoles(){const{type:e,table:t,isInvite:s,role:a,availableRoleItems:o,blockType:i}=this.props;if(o&&o.length>0)return o;const r=[];return"bot_permission"!==e&&r.push({role:"editor"}),"space"===t&&(0,T.U7)()&&r.push({role:"membership_admin"}),r.push({role:"read_and_write"}),"collection_view"!==i&&"collection_view_page"!==i||"bot_permission"===e&&"content_only_editor"!==a||r.push({role:"content_only_editor"}),t!==f.bx&&("bot_permission"!==e&&r.push({role:"comment_only"}),"bot_permission"===e&&"reader"!==a||r.push({role:"reader"})),s||r.push({role:"none"}),r}isRemovingSpaceUser(e){return this.props.table===f.bx&&"none"===e}handleSelect(e){this.props.role!==e&&this.handleSelectChange(e)}}const N=J},98905:(e,t,s)=>{s.d(t,{Z:()=>i});var a=s(49085);class o extends a.Z{getInitialState(){return{count:0}}}const i=new o}}]);