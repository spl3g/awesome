"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[383],{51582:(e,t,n)=>{n.d(t,{w:()=>f});var i=n(74335),o=n(64002),s=n(5366),a=n(50906),r=n(47307),c=n(95477),l=n(71935),d=n(46190),u=n(47593),g=n(54642),p=n(92625),h=n(15356);const m=(0,s.defineMessages)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});async function f(e){const{environment:t,requestStore:n}=e,s=(0,l.eC)(t);let f=(0,i.s1)(c.Z.domainBaseUrl,{authType:s,userId:t.currentUser.id});f=s.redirectToAuth?f:await(0,l.HU)(t,f);const v=await h.M(t,{width:580,height:800,url:f,titleMessage:m.titleMessage});if(!v)return;const y=o.Qc(v);if(!y.query.code||!y.query.state)return;p.j({message:m.authenticatingWithAsana});const S=await g.authWithAsana(t,{code:y.query.code,encryptedState:y.query.state});"failed"===S.type?(console.error(S.error),r.showError(S),p.x()):(a.trackAuthIntegration(t,{integration_name:"asana"}),await n.refresh(),d.Z.setState({open:!0}),u.Z.setState({open:!0}),p.x())}},22711:(e,t,n)=>{n.d(t,{LN:()=>s,C:()=>a,Ow:()=>r,Lm:()=>c});var i=n(50906),o=n(54642);async function s(e){const t=await o.getConnectedAppsStatus(e,{});if("failed"===t.type){const e=t.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0}}return t.data}async function a(e,t){await o.disconnectTrello(e,{}),await t.refresh(),i.trackRemoveIntegration(e,{integration_name:"trello"})}async function r(e,t){await o.disconnectAsana(e,{}),await t.refresh(),i.trackRemoveIntegration(e,{integration_name:"asana"})}async function c(e,t){await o.disconnectEvernote(e,{}),await t.refresh(),i.trackRemoveIntegration(e,{integration_name:"evernote"})}},83805:(e,t,n)=>{n.d(t,{e:()=>f});var i=n(74335),o=n(64002),s=n(5366),a=n(50906),r=n(47307),c=n(95477),l=n(71935),d=n(90365),u=n(47593),g=n(54642),p=n(92625),h=n(15356);const m=(0,s.defineMessages)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function f(e){const{environment:t,requestStore:n}=e,s=(0,l.eC)(t);let f=(0,i.Qp)(c.Z.domainBaseUrl,{authType:s,userId:t.currentUser.id});f=s.redirectToAuth?f:await(0,l.HU)(t,f);const v=await h.M(t,{width:580,height:700,url:f,titleMessage:m.titleMessage});if(!v)return;const y=o.Qc(v),S=y.query.oauth_token,b=y.query.oauth_verifier;if(!S||!b)return;p.j({message:m.authenticatingWithEvernote});const M=await g.authWithEvernote(t,{requestToken:S,verifier:b});if("failed"===M.type)return console.error(M.error),r.showError(M),void p.x();a.trackAuthIntegration(t,{integration_name:"evernote"}),await n.refresh(),d.Z.setState({open:!0}),u.Z.setState({open:!0}),p.x()}},52192:(e,t,n)=>{n.d(t,{M:()=>f});var i=n(74335),o=n(64002),s=n(5366),a=n(50906),r=n(47307),c=n(95477),l=n(71935),d=n(47593),u=n(82066),g=n(54642),p=n(92625),h=n(15356);const m=(0,s.defineMessages)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function f(e){const{environment:t,requestStore:n}=e,s=(0,l.eC)(t);let f=(0,i.ae)(c.Z.domainBaseUrl,{authType:s,userId:t.currentUser.id});f=s.redirectToAuth?f:await(0,l.HU)(t,f);const v=await h.M(t,{width:580,height:700,url:f,titleMessage:m.titleMessage});if(!v)return;const y=o.Qc(v),S=y.query.oauth_token,b=y.query.oauth_verifier;if(!S||!b)return;p.j({message:m.authenticatingWithTrello});const M=await g.authWithTrello(t,{requestToken:S,verifier:b});"failed"===M.type?(console.error(M.error),r.showError(M),p.x()):(a.trackAuthIntegration(t,{integration_name:"trello"}),await n.refresh(),u.Z.setState({open:!0}),d.Z.setState({open:!0}),p.x())}},11106:(e,t,n)=>{n.d(t,{Z:()=>Q});var i=n(77094),o=n.n(i),s=n(97464),a=n.n(s),r=n(77422),c=n.n(r),l=(n(33948),n(67294)),d=n.n(l),u=n(83355),g=n(480),p=n(28350),h=n(8848),m=n(59054),f=n(53397),v=n(27006),y=n(21202),S=n(29369),b=n(5366),M=n(65452),w=n(28020),A=n(86785),C=n(38755),k=n(27832),Z=n(80270),P=n(12318),I=n(86671),T=n(48762),x=n(82970),E=n(40039),N=n(79029),D=n(14694);class B extends I.Z{renderComponent(){const{isMobile:e,nestingLevel:t}=this.props;return d().createElement(T.Z,a()({},this.props,{title:o()(D.Z,{childrenStyle:B.sidebarChildrenStyle,left:this.renderLeftCheckbox(),icon:this.renderIcon(),isMobile:e,style:{marginLeft:8*t}},void 0,this.renderTitle())}))}renderLeftCheckbox(){return o()(x.Z,{size:16,checked:this.props.isChecked,onClick:this.props.onClick})}renderIcon(){const{store:e,isMobile:t}=this.props,n=e.getIcon();return o()(E.Z,{disabled:!0,icon:n,title:void 0,isEmptyPage:e.isEmptyPage(),size:t?24:20,pageIconStyle:{fill:this.theme.mediumIconColor}})}renderTitle(){return o()(N.Z,{store:this.props.store})}}c()(B,"sidebarChildrenStyle",{display:"flex",alignItems:"center"});const F=B;var _=n(62727),L=n(68932),q=n(25584),U=n(97880),W=n(31299),z=n(78948),O=n(71202),G=n(16328),R=n(24042),H=n(83071);function j(e){const{spaceId:t,onSelectPage:n,query:i,source:s,findSelectedBlockAncestorId:r}=e,c=(0,g.O7)();let l=null;const[{status:u,value:p}]=(0,m.r5)((async()=>await W.kz({environment:c,query:i,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:s})),[c,i,t,s],{debounce:W.vp});if("idle"===u||"pending"===u)l=o()(H.Z,{},void 0,o()(z.Z,{}));else{const e=((null==p?void 0:p.results)||[]).map((e=>{let{id:t}=e;const i=new Z.Z(c,{table:y.iU,id:t});return function(e){const{store:t,environment:n,alreadySelectedAncestorId:i,onSelectPage:s}=e;if(i&&i===t.id)return{key:t.id,action:()=>{},render:e=>d().createElement(R.Z,a()({},e,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:o()(b.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})}))};if(i){const e=new Z.Z(n,{table:y.iU,id:i});return{key:t.id,action:()=>{},render:n=>d().createElement(R.Z,a()({},n,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:o()(b.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:o()(N.Z,{store:e,style:{display:"inline"}})}})}))}}const r=t.getRole();return r&&v.zz(r)?{key:t.id,action:()=>s(t.id),render:e=>d().createElement(R.Z,a()({store:t,hidePath:!1},e))}:void 0}({store:i,alreadySelectedAncestorId:r(i),environment:c,onSelectPage:n})})).filter(U.$K);l=0===e.length?o()(H.Z,{},void 0,o()(G.Z,{title:o()(b.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})):function(e){return o()(q.Z,{type:q.Z.Type.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>d().createElement(H.Z,e)}]})}(e)}const h={menuType:O.Z.MenuType.Popup};return d().createElement(O.Z,h,l)}var K=n(66722);class V extends u.Z{constructor(){super(...arguments),c()(this,"storeTypes",{selectedBlockIdsStore:P.default.of({}),searchStore:P.default.of({open:!1,query:void 0})}),c()(this,"getPageSection",((e,t,n)=>{const i=n.filter((e=>v.zz(e.getRole()||"none")));return{key:e,render:e=>d().createElement(H.Z,e),items:[this.getPageSectionHeader(t,i),...0===i.length?[this.getEmptyState()]:i.map((e=>this.getPageItem(e,1)))]}})),c()(this,"getPageItem",((e,t)=>{const{selectedBlockIdsStore:n}=this.stores,{device:i}=this.environment,o=Boolean(n.state[e.id]);return{key:e.id,action:()=>this.props.onClickPage(e.id,o),render:n=>d().createElement(F,a()({},n,{isMobile:i.isMobile,store:e,isChecked:o,disabled:!1,nestingLevel:t}))}})),c()(this,"getPageSectionHeader",((e,t)=>{const{selectedBlockIdsStore:n}=this.stores,{device:i}=this.environment,s=t.length>0&&t.every((e=>n.state[e.id]));return{key:e,action:()=>this.props.onClickSection(t),render:t=>d().createElement(T.Z,a()({},t,{title:o()(D.Z,{left:o()(x.Z,{onClick:t.onClick,checked:s,size:16}),isMobile:i.isMobile,style:this.getSectionHeaderStyle()},void 0,e)}))}})),c()(this,"getEmptyState",(()=>{const{device:e}=this.environment;return{key:"empty",action:()=>{},render:t=>d().createElement(T.Z,a()({},t,{title:o()(D.Z,{isMobile:e.isMobile,style:{fontSize:14,color:this.theme.mediumTextColor,padding:"2px 32px"}},void 0,o()(b.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"}))}))}})),c()(this,"handleSearchQueryChange",(e=>{const t=this.stores.searchStore.state,n=e.length>0;this.stores.searchStore.setState({...t,query:e,open:n})})),c()(this,"handleSearchCancel",(()=>{const e=this.stores.searchStore.state;this.stores.searchStore.setState({...e,open:!1,query:void 0})})),c()(this,"findSelectedBlockAncestorId",(e=>{const{selectedBlockIdsStore:t}=this.stores;if(t.state[e.id])return e.id;const n=A.fJ(e).find((e=>e.table===y.iU&&Boolean(t.state[e.value.id])));return n?n.value.id:void 0}))}renderComponent(){const{intl:e}=this.props,{searchStore:t,selectedBlockIdsStore:n}=this.stores,{device:i}=this.environment,s=(0,w.k_)(this.environment).state;if(!s)return o()(L.Z,{style:{alignSelf:"center"}});const{allSharedPagesStores:r,showWorkspaceSection:c,showTeamSection:l,showSharedSection:u,showPrivateSection:g,showOnlyPrivateSection:p}=s,{currentSpaceViewStore:h,currentSpaceStore:m}=k.default.state;if(!h||!m)return;const v=[];if(l){const e=h.getTeamsStores();v.push(...e.map((e=>[e,e.getTeamPagesStores().filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type))])))}const M=h.getWorkspacePages().filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type)),A=h.getPrivatePages(this.environment).filter((e=>e.state.value&&"copy_indicator"!==e.state.value.type)),P=Object.keys(n.state).filter((e=>n.state[e])).map((e=>new Z.Z(this.environment,{table:y.iU,id:e}))).filter((e=>{var t;return(null===(t=e.state.value)||void 0===t?void 0:t.space_id)===m.id&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage(m.id,this.environment)&&!e.isTopLevelWorkspacePage(m.id)&&!(e.getParentTable()===S.e0)&&!r.some((t=>t.id===e.id))})),I=(0,C.getSpaceName)(this.environment,m),T=[];if(P.length>0&&T.push({key:"manual",render:e=>d().createElement(H.Z,a()({},e,{title:o()(D.Z,{isMobile:i.isMobile,style:this.getSectionHeaderStyle()},void 0,o()(b.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})),isTitleUppercase:!0})),items:P.map((e=>this.getPageItem(e,0)))}),c&&T.push(this.getPageSection("workspace",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace",description:"This word is used in the same context as the title for the Workspace section of the sidebar."}),M)),l)for(const[o,a]of v){const e=o.state.value;e&&T.push(this.getPageSection("team-".concat(e.id),e.name,a))}if(u&&T.push(this.getPageSection("shared",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared",description:"This word is used in the same context as the title for the Shared section of the sidebar."}),r)),g){const t=p?I||"":e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private",description:"This word is used in the same context as the title for the Private section of the sidebar."});T.push(this.getPageSection("private",t,A))}return d().createElement(d().Fragment,null,o()(K.GI,{origin:o()(_.Z,{focus:!0,focusAfterAnimation:!0,value:t.state.query||"",onChange:e=>{this.handleSearchQueryChange(e.target.value)},left:f.Z.searchThick(this.getSearchIconStyle()),placeholder:e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:I})}),sameWidthAsOrigin:!0,popupType:K.GI.PopupType.Popup,open:t.state.open,render:()=>o()(j,{spaceId:m.id,onSelectPage:e=>this.props.onClickPage(e,!1),query:t.state.query||"",source:"oauth",findSelectedBlockAncestorId:this.findSelectedBlockAncestorId}),onDismiss:this.handleSearchCancel}),o()("div",{style:this.getPageListStyle()},void 0,o()(q.Z,{type:q.Z.Type.Vertical,sections:T,initialFocus:void 0})))}getSectionHeaderStyle(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:this.theme.mediumTextColor,padding:"2px 0"}}getPageListStyle(){return{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:h.ZP.contentBorder,overflowY:"auto"}}getSearchIconStyle(){return{width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}}}const Q=function(e){const t=(0,g.O7)(),n=(0,p.VK)((()=>{var e;return null===(e=k.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),i=t.currentUser.id,s=(0,b.useIntl)(),[{status:r}]=(0,m.r5)((async()=>{n&&i&&await(0,M.l)({environment:t,spaceId:n,userId:i})}),[t,n,i]);return"pending"===r||"idle"===r?o()(L.Z,{style:{alignSelf:"center"}}):d().createElement(V,a()({intl:s},e))}},70578:(e,t,n)=>{n.d(t,{Z:()=>m});var i=n(77094),o=n.n(i),s=n(67294),a=n.n(s),r=n(480),c=n(53397),l=n(5366),d=n(89101),u=n(50906),g=n(33665),p=n(86512),h=n(42001);function m(){const e=(0,r.O7)();return a().createElement(a().Fragment,null,o()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:"".concat(d._j.integrations,"/all"),external:!0,onClick:()=>{u.trackDeveloperIntegrationsAllIntegrationsClick(e,{from:"integration-settings",href:"".concat(d._j.integrations,"/all")})}},void 0,o()(h.Z,{icon:c.Z.alias,isSmall:!0,isLightGray:!0},void 0,o()(l.FormattedMessage,{id:"connectionsSettingsLinks.connectionsGallery",defaultMessage:"Browse connections in Gallery",description:"This link, when clicked, takes users to a page where they can create their own public or private connection to external tools."}))),o()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:d._j.myIntegrations,external:!0,onClick:()=>{u.trackDeveloperIntegrationsMyIntegrationsClick(e,{from:"integration-settings",href:d._j.myIntegrations})}},void 0,o()(h.Z,{icon:c.Z.alias,isSmall:!0,isLightGray:!0},void 0,o()(l.FormattedMessage,{id:"connectionsSettingsLinks.manageConnections",defaultMessage:"Develop or manage integrations",description:"This link, when clicked, takes users to a page where they can create their own public or private connection."}))),o()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:(0,g.UY)("guides.publicAPI"),external:!0},void 0,o()(h.Z,{icon:c.Z.help,isSmall:!0,isLightGray:!0},void 0,o()(l.FormattedMessage,{id:"connectionsSettingsLinks.helpCenter",defaultMessage:"Learn more about connections",description:"This link, when clicked, will direct the user to the help center."}))))}},77383:(e,t,n)=>{n.d(t,{Z:()=>xe,O:()=>Te});var i=n(77094),o=n.n(i),s=n(77422),a=n.n(s),r=(n(33948),n(96486)),c=n.n(r),l=n(67294),d=n.n(l),u=n(83355),g=n(41892),p=n(74181),h=n(77420),m=n(9844),f=n(75246),v=n(90965),y=n(97880),S=n(5366),b=n(50906),M=n(54642),w=n(51582),A=n(76463),C=n(22711),k=n(47307),Z=n(91584),P=n(83805),I=n(89475),T=n(52192),x=n(89314),E=n(88594),N=n(38755),D=n(27832),B=n(88632),F=n(30874),_=n(41952),L=n(72087),q=n(78291),U=n(480),W=n(24405),z=n(82990),O=n(35402),G=n(42001),R=n(23189);function H(e){const{apps:t,numberOfConnectedApps:n}=e,i=(0,U.O7)(),[s,a]=(0,l.useState)(!1),r=t.filter((e=>!e.shouldHideInDiscover)),c=r.length>3&&!s,u=s?r:r.slice(0,3);return d().createElement(d().Fragment,null,o()(R.Z,{large:!0,divider:"full"},void 0,o()("div",{style:{display:"flex",justifyContent:"space-between",height:28}},void 0,o()(S.FormattedMessage,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections",description:"Section title for uninstalled connections"}),c&&o()(G.Z,{isBlue:!0,onClick:()=>{s||(a(!0),b.trackClickDiscoverAppsShowAll(i,{numberOfConnectedApps:n}))}},void 0,o()(S.FormattedMessage,{id:"connectedAppsSettings.discoverNewAppSection.showAll.label",defaultMessage:"Show all"})))),o()("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(3,", 1fr)"),gap:32}},void 0,u.map((e=>"string"==typeof e.logo&&e.onConnect&&o()(j,{appName:e.appName,caption:e.caption,shouldShowNewBadge:e.shouldShowNewBadge,logo:e.logo,onConnect:e.onConnect},e.id))).filter((e=>(0,y.$K)(e)))))}function j(e){const{appName:t,caption:n,logo:i,shouldShowNewBadge:s,onConnect:a}=e,r=(0,W.y)((e=>({card:{display:"flex",flexDirection:"column",width:160},image:{width:32,height:32,borderRadius:3},title:{fontWeight:z.Z.fontWeight.medium,fontSize:14,marginTop:8},caption:{marginTop:2,fontWeight:z.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:12,maxHeight:64,overflow:"hidden"},button:{marginLeft:-8,marginTop:3}})),[]);return o()("div",{style:r.card},void 0,o()("img",{style:r.image,src:i}),o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()("div",{style:r.title},void 0,t),s&&o()(O.Z,{})),o()("div",{style:r.caption},void 0,n),o()("div",{style:r.button},void 0,o()(G.Z,{isBlue:!0,onClick:a},void 0,o()(S.FormattedMessage,{id:"connectedAppSettingsDiscoverItem.connectButton.label",defaultMessage:"Connect"}))))}var K=n(70578),V=n(29368),Q=n(68932),Y=n(7765),$=n(11082),J=n(27386),X=n(80172),ee=n(46951),te=n(40039),ne=n(40235),ie=n(97464),oe=n.n(ie),se=(n(85827),n(28350)),ae=n(8848),re=n(26825),ce=n(21202),le=n(76464),de=n(93561),ue=n(21115),ge=n(12318),pe=n(24736),he=n(72693),me=n(11106),fe=n(48762),ve=n(46167),ye=n(82902),Se=n(71202),be=n(25584),Me=n(47966),we=n(83071);function Ae(e){const{botId:t,canSelectPageAccess:n,onConnect:i,onDisconnect:s}=e,[a,r]=(0,l.useState)(!1),[c]=(0,l.useState)(new ge.default({})),[{currentSpaceStore:u}]=(0,se.oR)(D.default),g=(0,U.O7)(),p=(0,U.Fy)(),[m]=(0,se.oR)(q.default),f=[];if(n){const e=(m.data?(0,ue.NM)(m.data):[]).find((e=>e.botId===t)),n=null==e?void 0:e.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{});n&&u&&(a||(c.setState(n),r(!0)),f.push({key:"actions for user guest connections",render:e=>d().createElement(we.Z,e),items:[{key:"update selected pages",render:(e,i)=>d().createElement(ye.Z,oe()({},e,{onFocus:i.onFocus,disableDefaultClick:!0,renderOrigin:e=>d().createElement(fe.Z,oe()({},e,{title:o()(S.FormattedMessage,{id:"userConnectionsSettings.actionMenu.selectPages.label",defaultMessage:"Access selected pages",description:"Menu option to update which workspace pages a guest connection has access to"})})),renderExtension:(e,i)=>{return o()("div",{style:{width:400,padding:20}},void 0,o()(me.Z,{onClickPage:(e,t)=>{c.setState({...c.state,[e]:!t})},onClickSection:e=>{const t=e.every((e=>c.state[e.id])),n=e.reduce(((e,n)=>(e[n.id]=!t,e)),{});c.setState({...c.state,...n})},selectedBlockIdsStore:c}),(s={leftText:o()(S.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.cancel",defaultMessage:"Cancel",description:"Button to cancel updating page permissions for a user-installed connection"}),leftAction:()=>{c.setState(n),i.close()},rightText:o()(S.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.update",defaultMessage:"Update access",description:"This button, once clicked, updates the pages that a user-installed connection has access to."}),rightAction:()=>{!function(e){const{botId:t,currentSpaceStore:n,environment:i,selectedBlockIdsStore:o,currentAccessedPages:s}=e,a=[],r=[],c=o.get();Object.keys(c).forEach((e=>{s.hasOwnProperty(e)&&!c[e]?a.push(e):!s.hasOwnProperty(e)&&c[e]&&r.push(e)}));const l=(0,_.Kv)(n,{table:h.cZ,id:t}).getValue(),d={type:"bot_permission",bot_id:t,role:(0,re.uH)(null==l?void 0:l.capabilities)},u={type:"bot_permission",bot_id:t,role:"none"};a.forEach((e=>{const t=(0,_.Kv)(n,{table:ce.iU,id:e});de.createAndCommit({userAction:"BlockPermissionsSettings.handlePermissionItemChange",environment:i,perform:e=>{le.ep({environment:i,store:t,permissionItems:[u],transaction:e})}})})),r.forEach((e=>{const t=(0,_.Kv)(n,{table:ce.iU,id:e});de.createAndCommit({userAction:"BlockPermissionsSettings.handlePermissionItemChange",environment:i,perform:e=>{le.ep({environment:i,store:t,permissionItems:[d],transaction:e})}})}))}({selectedBlockIdsStore:c,environment:g,currentSpaceStore:u,botId:t,currentAccessedPages:n}),i.close()}},o()("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24}},void 0,o()(Me.Z,{isLarge:!0,onClick:s.leftAction,style:{height:32}},void 0,s.leftText),o()(he.Z,{isLarge:!0,onClick:s.rightAction},void 0,s.rightText))));var s}})),action:()=>{}}]}))}const v=[];return i&&v.push({key:"connect account",render:e=>d().createElement(fe.Z,oe()({},e,{title:o()(S.FormattedMessage,{id:"userConnectionsSettings.actionMenu.connectAccount.label",defaultMessage:"Connect another account",description:"Menu option to connect another third-party account from an installed connection"}),onClick:i})),action:i}),v.push({key:"disconnect account",render:e=>d().createElement(fe.Z,oe()({},e,{title:o()("div",{style:{color:ae.ZP.red}},void 0,o()(S.FormattedMessage,{id:"userConnectionsSettings.actionMenu.disconnectAccount.label",defaultMessage:"Disconnect account",description:"Menu option to disconnect a third-party account from an installed connection"})),onClick:()=>{s()}})),action:()=>s()}),f.push({key:"actions for all user connections",render:e=>d().createElement(we.Z,e),items:v}),o()(ve.Z,{popupType:p.isMobile?ve.Z.PopupType.SlideUp:ve.Z.PopupType.Popup,renderOrigin:e=>d().createElement(pe.Z,oe()({},e,{isMobile:p.isMobile})),render:()=>o()(Se.Z,{menuType:p.isMobile?Se.Z.MenuType.ActionSheet:Se.Z.MenuType.Popup},void 0,o()(be.Z,{type:be.Z.Type.Vertical,sections:f,initialFocus:void 0}))})}function Ce(e){const{userConnections:t}=e;return o()(ne.Z,{columns:[{key:"connection",header:o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection",description:"Table header for access column in user connections table"}),style:{width:"40%"}},{key:"access",header:o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.title",defaultMessage:"Access",description:"Table header for access column in user connections table"}),style:{width:"40%"}},{key:"more",header:void 0,style:{width:"5%"}}],rows:ke(t)})}function ke(e){const t=[];return e.forEach((e=>{const{account:n,onDisconnect:i}=e;if(Array.isArray(n)){const o=n.map((t=>Ze({connection:{...e,onDisconnect:()=>{i(t)}},accountName:t.accountName})));t.push(...o)}else"string"!=typeof n&&void 0!==n||t.push(Ze({connection:e,accountName:n}))})),t}function Ze(e){const{accountName:t,connection:{id:n,appName:i,canSelectPageAccess:s,capabilities:a,logo:r,onConnect:c,onDisconnect:l}}=e;return{key:"".concat(n,"-").concat(t),columns:[o()(Pe,{accountName:t,connectionLogo:r,connectionName:i}),a,o()(Ae,{botId:n,canSelectPageAccess:s,connectionName:i,onConnect:c,onDisconnect:l})]}}function Pe(e){const{accountName:t,connectionLogo:n,connectionName:i}=e;return o()("div",{style:{display:"flex",alignItems:"center"}},void 0,"string"==typeof n?o()("img",{src:n,style:{height:28}}):o()(te.Z,{disabled:!0,icon:n,title:i,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),o()("div",{style:{marginLeft:15}},void 0,o()(ee.Z,{},void 0,i),t&&o()(ee.Z,{isSmall:!0},void 0,t)))}class Ie extends u.Z{constructor(){super(...arguments),a()(this,"storeTypes",{requestStore:L.Z}),a()(this,"loadConnections",(async e=>({guestBotIds:await this.fetchUserGuestBotIds(),connectionStatus:await C.LN(e)}))),a()(this,"fetchUserGuestBotIds",(async()=>{const{currentSpaceStore:e,currentUserStore:t}=D.default.state;if(!e||!t||!q.default.state.data)return[];return(await(0,A.Yw)({environment:this.environment,table:f.bx,id:e.id,type:"guest"})).botIds.filter((n=>{const i=(0,_.Kv)(e,{table:h.cZ,id:n}).getValue();return(null==i?void 0:i.created_by_id)===t.id}))}))}renderComponent(){return B.Z.state.online?o()(Y.Z,{request:this.environment,performRequest:this.loadConnections,requestStore:this.stores.requestStore,render:(e,t)=>null!=t&&t.connectionStatus?this.renderConnectedAppsSettings(t.guestBotIds):o()("div",{style:Ie.loadingWrapStyle},void 0,o()(Q.Z,{}))}):this.renderOfflineMessage()}renderOfflineMessage(){return o()(J.Z,{},void 0,o()(ee.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(S.FormattedMessage,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})))}renderConnectedAppsSettings(e){const{connected:t,discover:n}=this.getAppsByCategory(e),i=t.length>0;return o()("div",{style:Ie.wrapStyle},void 0,o()($.Z,{style:Ie.scrollerStyle,type:X.Z.Y},void 0,i&&d().createElement(d().Fragment,null,o()(R.Z,{large:!0,divider:"full",style:{borderBottom:"none",marginBottom:0}},void 0,o()(S.FormattedMessage,{id:"connectionsSettings.connectionsSection.title",defaultMessage:"My connections",description:"Section title for user integrations/connections tab in settings modal"})),o()(Ce,{userConnections:t})),o()("div",{style:{marginTop:i?32:void 0}},void 0,o()(H,{apps:n,numberOfConnectedApps:t.length})),o()(V.Z,{size:32}),o()("div",{style:{marginTop:8}},void 0,o()(K.Z,{}))))}async handleDriveAuth(){b.trackPromptAuthIntegration(this.environment,{integration_name:"google",from:"connected_apps"}),await Z.qN(this.environment),await C.LN(this.environment),await this.stores.requestStore.refresh()}handleDisconnectDrive(e){const{intl:t}=this.props;k.showDialog({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await M.disconnectDrive(this.environment,{googleUserId:e.accountId}),await C.LN(this.environment),await this.stores.requestStore.refresh()}}]})}getAppsByCategory(e){const t=c().groupBy([...this.getExternalIntegrations(),...this.getLegacyConnectedApps()],(e=>e.account&&e.account.length>0?"connected":"discover"));return{connected:[...this.getUserGuestIntegrations(e),...t.connected||[]],discover:t.discover||[]}}getLegacyConnectedApps(){var e;const{intl:t}=this.props,n=this.stores.requestStore,{currentSpaceStore:i}=D.default.state,s=null==i?void 0:i.getBotSettingsStore().getValue(),a=!(0,v.CJ)(s)||Boolean((null==s?void 0:s.integration_approval_statuses)&&s.integration_approval_statuses[p._o]),r=null===(e=n.state.result)||void 0===e?void 0:e.connectionStatus,c=(null==r?void 0:r.drive)&&(null==r?void 0:r.drive.length)>0,l=o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.legacyImporter",defaultMessage:"Can only add pages",description:"A label describing what capabilities a legacy importer connection has. Legacy importers include the Trello and Asana connections"});return[...a||c?[{id:"drive",appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files."}),shouldHideConnectAccount:!a,logo:g.Z.images.import.googleDrivePng,account:null==r?void 0:r.drive,capabilities:o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.googleDrive",defaultMessage:"Can embed content",description:"A label describing what capabilities the legacy Google Drive connection has"}),canSelectPageAccess:!1,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{e&&this.handleDisconnectDrive(e)}}]:[],{id:"evernote",appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks."}),logo:g.Z.images.import.evernotePng,account:null==r?void 0:r.evernote,capabilities:l,canSelectPageAccess:!1,onConnect:()=>P.e({environment:this.environment,requestStore:n}),onDisconnect:()=>C.Lm(this.environment,n)},{id:"trello",appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards."}),logo:g.Z.images.import.trelloPng,shouldHideInDiscover:!0,account:null==r?void 0:r.trello,capabilities:l,canSelectPageAccess:!1,onConnect:()=>T.M({environment:this.environment,requestStore:n}),onDisconnect:()=>C.C(this.environment,n)},{id:"asana",appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists."}),logo:g.Z.images.import.asanaPng,shouldHideInDiscover:!0,account:null==r?void 0:r.asana,capabilities:l,canSelectPageAccess:!1,onConnect:()=>w.w({environment:this.environment,requestStore:n}),onDisconnect:()=>C.Ow(this.environment,n)}]}getUserGuestIntegrations(e){const{currentSpaceStore:t}=D.default.state;if(!t||(0,N.isGuestOfSpace)(t))return[];return e.map((e=>{const n=(0,_.Kv)(t,{table:h.cZ,id:e}).getValue();if(!(n&&n.alive&&n.name&&n.integration_id))return;const i=n.icon?{pointer:{table:m.K2,id:n.integration_id},icon:n.icon}:void 0;return{id:n.id,appName:n.name,caption:void 0,account:void 0,logo:i,capabilities:o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.userGuest",defaultMessage:"Can {capabilities} content",description:"Bot capabilities for a public guest connection. Example: 'This bot can view and insert content'",values:{capabilities:o()(S.FormattedList,{value:Te(n.capabilities),type:"conjunction"})}}),canSelectPageAccess:!0,onDisconnect:async()=>{await k.confirmUserAction({message:o()("span",{},void 0,o()(S.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?",description:"Popup message when user selects 'Disconnect account' on the connection menu"})),acceptLabel:o()(S.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes",description:"Confirmation button when user uninstalls a connection"})})&&await(0,A.P0)({environment:this.environment,botId:n.id,onSuccess:()=>{}})}}})).filter(y.$K)}getExternalBotCapabilities(e){const t=[o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.previewLinks",defaultMessage:"preview links",description:"A bot can 'preview links' so content appears before clicking on a link"})];return(0,E.fe)(this.environment)&&(0,E.bx)(e)&&t.push(o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.syncDatabases",defaultMessage:"sync databases",description:"A bot can 'sync databases' so that pasted links can turn into a database"})),t}getExternalIntegrations(){const{currentSpaceStore:e}=D.default.state;if(!e||!e.canEdit())return[];const t=e.getBotSettingsStore().getValue(),n=e.id,{integrations:{state:i},bots:{state:s},externalAuthentications:{state:a}}=F.Z;return i.map((i=>{if(!i.info.icon)return;const r=s.filter((e=>e.integration_id===i.id)),l=c().compact(r.map((e=>{const t=a.find((t=>t.parent_id===e.id));if(t)return{accountId:e.id,accountName:t.account_name}}))),d=(0,v.hU)({spaceBotSettings:t,integrationId:i.id}),u=l.length>0;if(!d&&!u)return;const g=!d;return{id:i.id,appName:i.name,caption:i.info.tagline,logo:i.info.icon,account:l,shouldHideConnectAccount:g,shouldShowNewBadge:!0,capabilities:o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.external",defaultMessage:"Can {capabilities}",description:"Bot capabilities for a external connections. Example: 'This bot can preview links and sync databases'",values:{capabilities:o()(S.FormattedList,{value:this.getExternalBotCapabilities(i),type:"conjunction"})}}),canSelectPageAccess:!1,onConnect:async()=>{await(0,I.h)({environment:this.environment,integration:i,spaceId:n}),x.pJ({environment:this.environment}),b.trackConnectExternalIntegration(this.environment,{integrationId:i.id,numberOfAccountsAlreadyConnected:l.length,from:"connected_apps_settings"})},onDisconnect:async t=>{const n=s.find((e=>e.id===(null==t?void 0:t.accountId)));if(n){const s=(0,_.Kv)(e,{table:h.cZ,id:n.id,spaceId:n.space_id}),a=null!=t&&t.accountName?o()(S.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for {accountName}?",values:{accountName:t.accountName}}):o()(S.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"});await k.confirmUserAction({message:o()("span",{},void 0,a),acceptLabel:o()(S.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&(await(0,A.P0)({environment:this.environment,botId:s.id,onSuccess:()=>{}}),b.trackDisconnectExternalIntegration(this.environment,{integrationId:i.id}))}}}})).filter(y.$K)}}function Te(e){const t=[];return null!=e&&e.read_content&&t.push(o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.readContent",defaultMessage:"view",description:"Example: 'This bot can view page content'"})),null!=e&&e.insert_content&&t.push(o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.insertContent",defaultMessage:"insert",description:"Example: 'This bot can insert page content'"})),null!=e&&e.update_content&&t.push(o()(S.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.updateContent",defaultMessage:"update",description:"Example: 'This bot can update page content'"})),t}a()(Ie,"loadingWrapStyle",{alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"}),a()(Ie,"wrapStyle",{display:"flex",flexDirection:"column",height:"100%"}),a()(Ie,"scrollerStyle",{height:"100%",padding:"36px 60px"});const xe=(0,S.injectIntl)(Ie)},46190:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},90365:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)},82066:(e,t,n)=>{n.d(t,{Z:()=>i});const i=new(n(61766).Z)}}]);