"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[653],{45388:(e,t,r)=>{r.r(t),r.d(t,{default:()=>z});var a=r(97464),n=r.n(a),s=r(77094),o=r.n(s),i=(r(33948),r(17126)),d=r(67294),l=r.n(d),c=r(49509),p=r(480),u=r(28350),m=r(24405),y=r(32918),f=r(53397),g=r(4615),k=r(54061),h=r(97880),M=r(5366),v=r(3992),b=r(28020),w=r(25498),I=r(43860),P=r(48762),S=r(46167),C=r(77422),F=r.n(C),Z=r(96486),E=r.n(Z),R=r(83355),q=r(39500),x=r(61766),T=r(19757),O=r(66722);class A extends R.Z{constructor(){super(...arguments),F()(this,"storeTypes",{buttonPopupStore:x.Z}),F()(this,"renderPopup",(()=>this.props.render({close:this.handleClose}))),F()(this,"handleButtonClick",(e=>{const{buttonPopupStore:t}=this.stores;this.props.stopClickPropagation&&(null==e||e.stopPropagation()),e&&q.uG(e)||(this.props.onClick&&this.props.onClick(e),this.props.disablePopup||t.setState({...t.state,open:!0}))})),F()(this,"handleClose",(()=>{this.props.onClose&&this.props.onClose(),this.props.persistOnClose||this.stores.buttonPopupStore.reset()}))}willUnmount(){this.stores.buttonPopupStore.setState({open:!1})}renderComponent(){const{buttonPopupStore:e}=this.stores,t={...this.props,onClick:this.props.disabled?E().identity:this.handleButtonClick};return l().createElement(O.ZP,n()({},this.props,{forceInitialInbound:Boolean(this.props.forceInitialInbound),render:this.renderPopup,open:e.state.open,onDismiss:this.handleClose,origin:this.props.renderOrigin(t),originGap:this.props.originGap,borderRadius:this.props.borderRadius,popupWrapStyle:this.props.popupWrapStyle}))}}F()(A,"Alignment",T.v2),F()(A,"Placement",T.ug),F()(A,"PopupType",O.kQ);const D=A;var _=r(82970),B=r(93289),K=r(1464),L=r(71202),U=r(86646),V=r(25584),W=r(42001),X=r(83071),j=r(20083);const z=(0,d.forwardRef)((function(e,t){const r=(0,p.O7)(),{device:a}=r,s=(0,m.F)(),[y,g]=(0,d.useState)(!1),[w,C]=(0,d.useState)({...N(),frequency:"day",interval:1}),[F,Z]=(0,d.useState)(!0),E=e.templateStore,R=(0,u.VK)((()=>(0,I.n)(E)),[E]),q=(0,u.VK)((()=>void 0===E.getAutomationId()||(null==R?void 0:R.isReady())),[E,R]),x=(0,u.VK)((()=>{var e;return null!==(e=null==R?void 0:R.isActive())&&void 0!==e&&e}),[R]),T=(0,u.VK)((()=>null==R?void 0:R.getRecurrence()),[R]);F&&q&&(void 0!==T&&C(T),Z(!1));const O=a.isMobile?S.Z.PopupType.SlideUp:S.Z.PopupType.Popup;return l().createElement(D,n()({},e,{popupType:O,ref:t,renderOrigin:t=>l().createElement(K.Z,n()({},t,{icon:f.Z.repeat({width:14}),title:o()(M.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.actionMenu.repeat"}),focused:e.focused,showExtensionArrow:a.isMobile,right:q&&ne({isActive:x,recurrence:T})})),render:t=>l().createElement(L.Z,function(e,t){return t?{menuType:L.Z.MenuType.Modal,title:o()(M.FormattedMessage,{defaultMessage:"Repeat",id:"database.templatePickerItem.mobileRepeatModal.title"}),right:o()(M.FormattedMessage,{defaultMessage:"Done",id:"ddatabase.templatePickerItem.mobileDoneRepeatButton.label"}),onClickRight:e.close}:{menuType:L.Z.MenuType.Popup,width:250}}(t,a.isMobile),y?l().createElement(l().Fragment,null,o()(X.Z,{style:G},void 0,o()(j.Z,{selectedTitle:$(w.frequency),renderMenuSections:a=>[{key:"repeatOptionsSection",render:e=>l().createElement(X.Z,e),items:[...te({parent:a,updateFrequencyFn:e=>{(e=>{const t="week"!==e||void 0!==w.weekdays&&0!==w.weekdays.length?w.weekdays:[(r=w.start_date,(0,h.Yd)(k.RRULE_WEEKDAYS_MAP)[i.ou.fromMillis(r).weekday-1])];var r;C({...w,weekdays:t,frequency:e})})(e)}}),re({environment:r,parent:a,templateStore:e.templateStore,onClose:()=>{g(!1),t.close()}})]}]}),o()(W.Z,{isBlue:!0,onClick:a=>{(0,v.addRecurrence)({environment:r,blockStore:e.templateStore,recurrence:w}),t.close()}},void 0,o()(M.FormattedMessage,{defaultMessage:"Save",id:"database.templatePickerItem.customRecurrence.save",description:"Save the custom repeat settings"}))),o()(X.Z,{style:H},void 0,o()(j.Z,{selectedTitle:w.interval,label:o()(M.FormattedMessage,{defaultMessage:"Every",id:"database.templatePickerItem.repeatMenu.every",description:"Interval to repeat, e.g. Every X days/weeks/months/years"}),labelStyle:{color:s.regularTextColor,paddingRight:5},renderMenuSections:e=>[{key:"repeatOptionsSection",render:e=>l().createElement(X.Z,e),items:ae({parent:e,updateIntervalFn:e=>{C({...w,interval:e})}})}]}),o()("label",{style:J(s)},void 0,function(e){switch(e){case"day":return o()(M.FormattedMessage,{defaultMessage:"days",id:"database.templatePickerItem.recurrenceInterval.days",description:"Configure to repeat every X days."});case"week":return o()(M.FormattedMessage,{defaultMessage:"weeks",id:"database.templatePickerItem.recurrenceInterval.weeks",description:"Configure to repeat every X weeks."});case"month":return o()(M.FormattedMessage,{defaultMessage:"months",id:"database.templatePickerItem.recurrenceInterval.months",description:"Configure to repeat every X months."});case"year":return o()(M.FormattedMessage,{defaultMessage:"years",id:"database.templatePickerItem.recurrenceInterval.years",description:"Configure to repeat every X years."});default:(0,h.t1)(e)}}(w.frequency))),"week"===w.frequency&&o()(X.Z,{style:Y},void 0,c.Z.map((e=>o()("div",{},void 0,o()("div",{},void 0,e[0]),o()(_.Z,{size:16,checked:void 0!==w.weekdays&&w.weekdays.includes(e),onClick:t=>{let r;r=void 0===w.weekdays?[e]:w.weekdays.includes(e)?w.weekdays.filter((t=>t!==e)):[...w.weekdays,e],C({...w,weekdays:r})}}))))),o()(S.Z,{popupType:O,renderOrigin:e=>l().createElement(K.Z,n()({},e,{title:o()(M.FormattedMessage,{defaultMessage:"Starts",id:"database.templatePickerItem.repeatMenu.starts",description:"Day to start the repeat"}),focused:!1,showExtensionArrow:a.isMobile,right:i.ou.fromMillis(w.start_date).toLocaleString({weekday:"short",month:"short",day:"numeric",year:"numeric"})})),render:e=>o()("div",{style:{padding:"18px 14px 14px"}},void 0,o()(B.Z,{firstDayOfWeek:b.AK.state,value:w.start_date,onChange:t=>{C({...w,start_date:t}),e.close()}}))})):o()(V.Z,{type:V.Z.Type.Vertical,sections:[{key:"repeatOptionsSection",render:e=>l().createElement(X.Z,e),items:[...ee(r,t,e.templateStore),{key:"custom",action:()=>{g(!0)},render:e=>l().createElement(P.Z,n()({},e,{title:o()(M.FormattedMessage,{defaultMessage:"Custom...",id:"database.templatePickerItem.quickOptionMenuItem.custom",description:"Open menu to custom configure repeat options."})}))},re({environment:r,parent:t,templateStore:e.templateStore})]}],initialFocus:void 0}),x&&q&&function(e,t){const r=(0,k.rruleFromRecurrence)(e).after(new Date((0,k.convertDateToUtcRepresentation)())),a=i.ou.fromJSDate(r).toUTC().toLocaleString(i.ou.DATETIME_SHORT);return o()(X.Z,{topBorder:!0},void 0,o()(U.Z,{caption:o()("span",{style:{color:t.lightTextColor}},void 0,o()(M.FormattedMessage,{defaultMessage:"Next at: {dates}",id:"database.templatePickerItem.recurrenceConfigMenuLabel.next",description:"When repeat will happen next.",values:{dates:a}}))}))}(w,s))}))})),G={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px"},Y={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 20px 10px 20px",textAlign:"center"},H={...G,alignItems:"baseline",justifyContent:"flex-start",paddingLeft:14};function J(e){return{color:e.lightTextColor,fontSize:14,padding:10}}function N(){return{id:(0,g.ZP)(),start_date:Date.now(),timezone:(0,y.Sv)()}}function Q(e){switch(e){case"day":return o()(M.FormattedMessage,{defaultMessage:"Every day",id:"database.templatePickerItem.quickOptionMenuItem.day"});case"week":return o()(M.FormattedMessage,{defaultMessage:"Every week",id:"database.templatePickerItem.quickOptionMenuItem.week"});case"month":return o()(M.FormattedMessage,{defaultMessage:"Every month",id:"database.templatePickerItem.quickOptionMenuItem.month"});case"year":return o()(M.FormattedMessage,{defaultMessage:"Every year",id:"database.templatePickerItem.quickOptionMenuItem.year"});default:(0,h.t1)(e)}}function $(e){switch(e){case"day":return o()(M.FormattedMessage,{defaultMessage:"Repeat daily",id:"database.templatePickerItem.recurrenceFrequency.daily",description:"Configure to repeat by day."});case"week":return o()(M.FormattedMessage,{defaultMessage:"Repeat weekly",id:"database.templatePickerItem.recurrenceFrequency.weekly",description:"Configure to repeat by week."});case"month":return o()(M.FormattedMessage,{defaultMessage:"Repeat monthly",id:"database.templatePickerItem.recurrenceFrequency.monthly",description:"Configure to repeat by month."});case"year":return o()(M.FormattedMessage,{defaultMessage:"Repeat yearly",id:"database.templatePickerItem.recurrenceFrequency.yearly",description:"Configure to repeat by year."});default:(0,h.t1)(e)}}function ee(e,t,r){return w.m.map((a=>({key:a.frequency,action:()=>{(0,v.addRecurrence)({environment:e,recurrence:{...N(),...a},blockStore:r}),t.close()},render:e=>l().createElement(P.Z,n()({},e,{title:Q(a.frequency)}))})))}function te(e){let{parent:t,updateFrequencyFn:r}=e;return w.m.map((e=>({key:e.frequency,action:()=>{r(e.frequency),t.close()},render:t=>l().createElement(P.Z,n()({},t,{title:$(e.frequency)}))})))}function re(e){let{environment:t,parent:r,templateStore:a,onClose:s}=e;return{key:"disable",action:()=>{(0,v.disableRecurrence)({environment:t,blockStore:a}),r.close(),s&&s()},render:e=>l().createElement(P.Z,n()({},e,{title:o()(M.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.quickOptionMenuItem.off",description:"Turn off automatically repeating a task."})}))}}function ae(e){let{parent:t,updateIntervalFn:r}=e;return[...Array(12).keys()].map((e=>{const a=e+1;return{key:"interval ".concat(a),action:()=>{r(a),t.close()},render:e=>l().createElement(P.Z,n()({},e,{title:a}))}}))}function ne(e){let{isActive:t,recurrence:r}=e;return t?r?l().createElement(l().Fragment,null,Q(r.frequency)):void 0:o()(M.FormattedMessage,{defaultMessage:"Off",id:"database.templatePickerItem.recurrenceConfigMenuLabel.off",description:"Indicate there is no repeat configured."})}}}]);